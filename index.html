<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Showdown Poker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            width: 100vw;
            height: 100vh;
            padding: 8px;
            box-sizing: border-box;
            overflow: hidden;
        }

        .screen {
            display: none;
            width: 100%;
            height: 100%;
            padding: 16px;
            box-sizing: border-box;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            overflow-y: auto;
            text-align: center;
        }

        .screen.active {
            display: block;
        }

        h1 {
            font-size: 24px;
            margin: 16px 0;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        h2 {
            font-size: 18px;
            margin: 12px 0;
        }

        h3 {
            font-size: 16px;
            margin: 8px 0;
        }

        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 14px;
            color: white;
            cursor: pointer;
            margin: 6px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            min-height: 44px;
            min-width: 80px;
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .nickname-input {
            padding: 12px 16px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            margin: 16px 0;
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            width: 250px;
            max-width: 90%;
        }

        /* ê²Œì„ í™”ë©´ - ë‹¨ìˆœí•œ ì„¸ë¡œ ë ˆì´ì•„ì›ƒ */
        .game-area {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 40px);
            gap: 12px;
            padding: 0;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            flex-shrink: 0;
        }

        .card-piles {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            flex-shrink: 0;
        }

        .pile-image {
            width: 45px;
            height: 65px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
            text-align: center;
        }

        .pile-deck {
            background: linear-gradient(45deg, #2c5aa0, #1e3c72);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .pile-discard {
            background: linear-gradient(45deg, #8e44ad, #9b59b6);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .player-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            gap: 8px;
            min-height: 0;
        }

        .player-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 8px;
        }

        .hand {
            display: flex;
            justify-content: center;
            gap: 4px;
            padding: 0 8px;
            flex-wrap: nowrap;
        }

        .card {
            width: 50px;
            height: 70px;
            background: white;
            border: 1px solid #333;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
            font-weight: bold;
            font-size: 11px;
            position: relative;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .card.selected {
            border-color: #e74c3c;
            box-shadow: 0 0 8px rgba(231, 76, 60, 0.6);
            background: #ffe6e6;
            transform: translateY(-4px);
        }

        .card.red {
            color: #e74c3c;
        }

        .card.black {
            color: #2c3e50;
        }

        .card.joker {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            font-size: 12px;
        }

        .card-back {
            background: linear-gradient(45deg, #2c5aa0, #1e3c72);
            color: white;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
            padding: 8px;
            flex-shrink: 0;
        }

        .result {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px;
            border-radius: 6px;
            margin: 4px 0;
            font-size: 11px;
        }

        .result h3, .result h4 {
            color: #ffd700;
            margin-bottom: 4px;
            font-size: 12px;
        }

        .ranking {
            margin-top: 16px;
            text-align: left;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .ranking h2 {
            text-align: center;
            margin-bottom: 12px;
            color: #ffd700;
            font-size: 18px;
        }

        .ranking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin: 4px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            font-size: 12px;
        }

        .ranking-item:first-child {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid #ffd700;
        }

        .ranking-item.current-player {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4caf50;
        }

        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes flyToPile {
            from { transform: translateX(0) translateY(0) scale(1); opacity: 1; }
            to { transform: translateX(-200px) translateY(0) scale(0.5); opacity: 0; }
        }

        @keyframes flyFromPile {
            from { transform: translateX(200px) translateY(0) scale(0.5); opacity: 0; }
            to { transform: translateX(0) translateY(0) scale(1); opacity: 1; }
        }

        .card.flying-to-pile {
            animation: flyToPile 0.8s ease-out forwards;
        }

        .card.flying-from-pile {
            animation: flyFromPile 0.8s ease-out forwards;
        }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 768px) {
            .card {
                width: 45px;
                height: 63px;
                font-size: 10px;
            }
            
            .hand {
                gap: 3px;
            }
            
            .game-info {
                font-size: 11px;
                padding: 6px 10px;
            }
            
            button {
                padding: 10px 16px;
                font-size: 13px;
                margin: 4px;
            }
            
            .pile-image {
                width: 40px;
                height: 56px;
                font-size: 9px;
            }
        }

        @media (max-width: 400px) {
            .card {
                width: 40px;
                height: 56px;
                font-size: 9px;
            }
            
            .hand {
                gap: 2px;
            }
            
            .game-info {
                font-size: 10px;
                padding: 4px 8px;
            }
            
            button {
                padding: 8px 12px;
                font-size: 12px;
                margin: 3px;
            }
            
            .pile-image {
                width: 35px;
                height: 49px;
                font-size: 8px;
            }
            
            .container {
                padding: 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ë‹‰ë„¤ì„ ì…ë ¥ í™”ë©´ -->
        <div class="screen active" id="nicknameScreen">
            <h1>ğŸƒ Showdown Poker ğŸƒ</h1>
            <h2>ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ê³  ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”</h2>
            <input type="text" class="nickname-input" id="nicknameInput" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" maxlength="10">
            <br>
            <button type="button" onclick="startGame()">ê²Œì„ ì‹œì‘</button>
            <button type="button" onclick="showRanking()">ë­í‚¹ ë³´ê¸°</button>
        </div>

        <!-- ë­í‚¹ í™”ë©´ -->
        <div class="screen" id="rankingScreen">
            <h1>ğŸ† ë­í‚¹ ğŸ†</h1>
            <div class="ranking">
                <div id="rankingList">
                    <div class="ranking-item">
                        <span>ìˆœìœ„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
                    </div>
                </div>
            </div>
            <button type="button" onclick="showNicknameInput()">ëŒì•„ê°€ê¸°</button>
        </div>

        <!-- ê²Œì„ í™”ë©´ -->
        <div class="screen" id="gameScreen">
            <div class="game-area">
                <!-- ê²Œì„ ì •ë³´ -->
                <div class="game-info">
                    <div>
                        <div>í”Œë ˆì´ì–´: <span id="playerName"></span></div>
                        <div>ì ìˆ˜: <span id="playerScore">0</span></div>
                    </div>
                    <div>
                        <div>ë¼ìš´ë“œ: <span id="currentRound">1</span> / 5</div>
                        <div>êµí™˜: <span id="exchangesLeft">3</span></div>
                    </div>
                    <div>
                        <div>ì»´í“¨í„°: <span id="computerScore">0</span></div>
                    </div>
                </div>

                <!-- ì¹´ë“œë”ë¯¸ë“¤ -->
                <div class="card-piles">
                    <div class="pile-image pile-discard">
                        <div>ë²„ë¦°<br>ì¹´ë“œ</div>
                    </div>
                    <div class="pile-image pile-deck">
                        <div>ì¹´ë“œ<br>ë±</div>
                    </div>
                </div>

                <!-- í”Œë ˆì´ì–´ ì˜ì—­ -->
                <div class="player-area">
                    <div class="player-section">
                        <h3>ì»´í“¨í„° ì¹´ë“œ</h3>
                        <div class="hand" id="computerHand"></div>
                        <div class="result" id="computerResult"></div>
                    </div>
                    
                    <div class="player-section">
                        <h3>ë‚´ ì¹´ë“œ (í„°ì¹˜í•˜ì—¬ êµì²´ ì„ íƒ)</h3>
                        <div class="hand" id="playerHand"></div>
                        <div class="result" id="playerCurrentHand">
                            <h4>í˜„ì¬ íŒ¨: <span id="currentHandRank">-</span></h4>
                            <p>ì˜ˆìƒ ì ìˆ˜: <span id="currentHandScore">0</span>ì </p>
                        </div>
                        <div class="result" id="playerResult"></div>
                    </div>
                </div>

                <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ë“¤ -->
                <div class="controls">
                    <button type="button" id="exchangeBtn" onclick="exchangeCards()">ì¹´ë“œ êµí™˜</button>
                    <button type="button" id="finishRoundBtn" onclick="finishRound()" style="display: none;">ë¼ìš´ë“œ ì™„ë£Œ</button>
                    <button type="button" id="nextRoundBtn" onclick="nextRound()" style="display: none;">ë‹¤ìŒ ë¼ìš´ë“œ</button>
                    <button type="button" id="newGameBtn" onclick="showNewGameOptions()" style="display: none;">ê²Œì„ ì™„ë£Œ</button>
                    <button type="button" onclick="showNicknameInput()">ìƒˆ ê²Œì„</button>
                </div>
            </div>
        </div>

        <!-- ê²Œì„ ì™„ë£Œ í™”ë©´ -->
        <div class="screen" id="gameCompleteScreen">
            <h1 id="gameResult"></h1>
            <div id="finalScores"></div>
            
            <div class="ranking">
                <h2>ğŸ† ìµœì¢… ë­í‚¹ ğŸ†</h2>
                <div id="finalRankingList">
                    <div class="ranking-item">
                        <span>ìˆœìœ„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
                    </div>
                </div>
            </div>
            
            <button type="button" onclick="startNewGame()">ìƒˆ ê²Œì„</button>
        </div>
    </div>

    <script>
        console.log('ê²Œì„ ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘');
        
        // ê²Œì„ ìƒíƒœ ë³€ìˆ˜
        let currentPlayer = '';
        let currentRound = 1;
        let playerScore = 0;
        let computerScore = 0;
        let playerHand = [];
        let computerHand = [];
        let deck = [];
        let exchangesLeft = 3;
        let computerExchangesLeft = 3;
        let roundComplete = false;

        // ì¹´ë“œ ìƒì„±
        const suits = ['H', 'D', 'C', 'S'];
        const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];

        class Card {
            constructor(suit, rank, isJoker = false) {
                this.suit = suit;
                this.rank = rank;
                this.isJoker = isJoker;
                this.isSelected = false;
                this.value = isJoker ? 0 : (rank === 'A' ? 1 : (rank === 'J' ? 11 : (rank === 'Q' ? 12 : (rank === 'K' ? 13 : parseInt(rank)))));
            }

            toString() {
                if (this.isJoker) return 'JOKER';
                return `${this.rank}${this.suit}`;
            }

            getColor() {
                if (this.isJoker) return 'joker';
                return (this.suit === 'H' || this.suit === 'D') ? 'red' : 'black';
            }
        }

        // ë± ìƒì„±
        function createDeck() {
            console.log('ë± ìƒì„± ì¤‘');
            deck = [];
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 13; j++) {
                    deck.push(new Card(suits[i], ranks[j]));
                }
            }
            deck.push(new Card('', 'JOKER', true));
            console.log('ë± ìƒì„± ì™„ë£Œ:', deck.length);
        }

        // ë± ì…”í”Œ
        function shuffleDeck() {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        // ì¹´ë“œ ë°°ë¶„
        function dealCards() {
            playerHand = [];
            computerHand = [];
            for (let i = 0; i < 5; i++) {
                playerHand.push(deck.pop());
                computerHand.push(deck.pop());
            }
        }

        // í¬ì»¤ ì¡±ë³´ íŒì •
        function evaluateHand(hand) {
            const counts = {};
            const suits = {};
            let hasJoker = false;
            
            hand.forEach(card => {
                if (card.isJoker) {
                    hasJoker = true;
                } else {
                    counts[card.value] = (counts[card.value] || 0) + 1;
                    suits[card.suit] = (suits[card.suit] || 0) + 1;
                }
            });

            const values = Object.keys(counts).map(k => parseInt(k)).sort((a, b) => a - b);
            const countValues = Object.values(counts).sort((a, b) => b - a);
            const suitCounts = Object.values(suits);
            
            if (hasJoker) {
                return evaluateWithJoker(counts, suits, values, suitCounts);
            }

            return evaluateNormalHand(counts, suits, values, countValues, suitCounts);
        }

        function evaluateWithJoker(counts, suits, values, suitCounts) {
            const countValues = Object.values(counts).sort((a, b) => b - a);
            
            // ìŠ¤íŠ¸ë ˆì´íŠ¸ ì²´í¬
            const straightResult = checkStraightWithJoker(values, suitCounts);
            if (straightResult.isStraight) {
                if (straightResult.isFlush) {
                    if (straightResult.isRoyal) {
                        return { rank: 10, name: 'ë¡œì–„ í”ŒëŸ¬ì‹œ', score: 1000 };
                    }
                    return { rank: 9, name: 'ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‹œ', score: 900 };
                }
                return { rank: 5, name: 'ìŠ¤íŠ¸ë ˆì´íŠ¸', score: 500 };
            }
            
            // í”ŒëŸ¬ì‹œ
            if (suitCounts.length === 1 && suitCounts[0] === 4) {
                return { rank: 6, name: 'í”ŒëŸ¬ì‹œ', score: 600 };
            }
            
            // í¬ì¹´ë“œ
            if (countValues.length > 0 && countValues[0] === 3) {
                return { rank: 8, name: 'í¬ì¹´ë“œ', score: 800 };
            }
            
            // í’€í•˜ìš°ìŠ¤
            if (countValues.length >= 2 && countValues[0] === 2 && countValues[1] === 2) {
                return { rank: 7, name: 'í’€í•˜ìš°ìŠ¤', score: 700 };
            }
            
            // íŠ¸ë¦¬í”Œ
            if (countValues.length > 0 && countValues[0] === 2) {
                return { rank: 4, name: 'íŠ¸ë¦¬í”Œ', score: 400 };
            }
            
            // ì›í˜ì–´
            return { rank: 2, name: 'ì›í˜ì–´', score: 200 };
        }

        function checkStraightWithJoker(values, suitCounts) {
            if (values.length < 4) return { isStraight: false, isFlush: false, isRoyal: false };
            
            const sortedValues = [...values].sort((a, b) => a - b);
            const isFlush = suitCounts.length === 1 && suitCounts[0] === 4;
            
            const straightPatterns = [
                [1, 2, 3, 4, 5], [2, 3, 4, 5, 6], [3, 4, 5, 6, 7],
                [4, 5, 6, 7, 8], [5, 6, 7, 8, 9], [6, 7, 8, 9, 10],
                [7, 8, 9, 10, 11], [8, 9, 10, 11, 12], [9, 10, 11, 12, 13],
                [10, 11, 12, 13, 1]
            ];
            
            for (const pattern of straightPatterns) {
                let adjustedPattern = [...pattern];
                let adjustedValues = [...sortedValues];
                
                if (pattern.includes(10) && pattern.includes(1)) {
                    adjustedPattern = pattern.map(v => v === 1 ? 14 : v);
                    adjustedValues = sortedValues.map(v => v === 1 ? 14 : v);
                }
                
                let matchCount = 0;
                for (const value of adjustedPattern) {
                    if (adjustedValues.includes(value)) {
                        matchCount++;
                    }
                }
                
                if (matchCount === 4) {
                    const isRoyal = pattern.includes(1) && pattern.includes(10) && 
                                  pattern.includes(11) && pattern.includes(12) && pattern.includes(13);
                    return { 
                        isStraight: true, 
                        isFlush: isFlush, 
                        isRoyal: isRoyal && isFlush 
                    };
                }
            }
            
            return { isStraight: false, isFlush: isFlush, isRoyal: false };
        }

        function evaluateNormalHand(counts, suits, values, countValues, suitCounts) {
            const isFlush = suitCounts.length === 1;
            const isStraight = checkStraight(values);
            
            if (isFlush && isStraight && values.includes(1) && values.includes(10)) {
                return { rank: 10, name: 'ë¡œì–„ í”ŒëŸ¬ì‹œ', score: 1000 };
            }
            
            if (isFlush && isStraight) {
                return { rank: 9, name: 'ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‹œ', score: 900 };
            }
            
            if (countValues[0] === 4) {
                return { rank: 8, name: 'í¬ì¹´ë“œ', score: 800 };
            }
            
            if (countValues[0] === 3 && countValues[1] === 2) {
                return { rank: 7, name: 'í’€í•˜ìš°ìŠ¤', score: 700 };
            }
            
            if (isFlush) {
                return { rank: 6, name: 'í”ŒëŸ¬ì‹œ', score: 600 };
            }
            
            if (isStraight) {
                return { rank: 5, name: 'ìŠ¤íŠ¸ë ˆì´íŠ¸', score: 500 };
            }
            
            if (countValues[0] === 3) {
                return { rank: 4, name: 'íŠ¸ë¦¬í”Œ', score: 400 };
            }
            
            if (countValues[0] === 2 && countValues[1] === 2) {
                return { rank: 3, name: 'íˆ¬í˜ì–´', score: 300 };
            }
            
            if (countValues[0] === 2) {
                return { rank: 2, name: 'ì›í˜ì–´', score: 200 };
            }
            
            return { rank: 1, name: 'í•˜ì´ì¹´ë“œ', score: Math.max(...values) * 10 };
        }

        function checkStraight(values) {
            if (values.length !== 5) return false;
            
            for (let i = 1; i < values.length; i++) {
                if (values[i] !== values[i-1] + 1) {
                    break;
                }
                if (i === values.length - 1) return true;
            }
            
            const royal = [1, 10, 11, 12, 13];
            if (royal.every(v => values.includes(v))) {
                return true;
            }
            
            return false;
        }

        // UI í•¨ìˆ˜ë“¤
        function showScreen(screenId) {
            console.log('í™”ë©´ ì „í™˜:', screenId);
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.add('active');
            }
        }

        function showNicknameInput() {
            console.log('ë‹‰ë„¤ì„ ì…ë ¥ í™”ë©´ìœ¼ë¡œ ì´ë™');
            showScreen('nicknameScreen');
            const input = document.getElementById('nicknameInput');
            if (input) {
                input.value = '';
                input.focus();
            }
        }

        function showRanking() {
            console.log('ë­í‚¹ í™”ë©´ìœ¼ë¡œ ì´ë™');
            showScreen('rankingScreen');
            updateRankingDisplay();
        }

        function startGame() {
            console.log('ê²Œì„ ì‹œì‘ í•¨ìˆ˜ í˜¸ì¶œë¨');
            const nicknameInput = document.getElementById('nicknameInput');
            if (!nicknameInput) {
                console.error('ë‹‰ë„¤ì„ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                return;
            }
            
            const nickname = nicknameInput.value.trim();
            console.log('ì…ë ¥ëœ ë‹‰ë„¤ì„:', nickname);
            
            if (!nickname) {
                alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            currentPlayer = nickname;
            currentRound = 1;
            playerScore = 0;
            computerScore = 0;
            
            console.log('ê²Œì„ í™”ë©´ìœ¼ë¡œ ì „í™˜');
            showScreen('gameScreen');
            startNewRound();
        }

        function startNewRound() {
            console.log('ìƒˆ ë¼ìš´ë“œ ì‹œì‘:', currentRound);
            exchangesLeft = 3;
            computerExchangesLeft = 3;
            roundComplete = false;
            
            createDeck();
            shuffleDeck();
            dealCards();
            
            playerHand.forEach(card => {
                card.isSelected = false;
            });
            
            animateInitialDeal();
        }

        function animateInitialDeal() {
            updateGameUI();
            updateHandDisplay(true);
            
            const playerCurrentHand = document.getElementById('playerCurrentHand');
            const playerResult = document.getElementById('playerResult');
            const computerResult = document.getElementById('computerResult');
            
            if (playerCurrentHand) playerCurrentHand.style.display = 'block';
            if (playerResult) playerResult.innerHTML = '';
            if (computerResult) computerResult.innerHTML = '';
            
            const currentHandRank = document.getElementById('currentHandRank');
            const currentHandScore = document.getElementById('currentHandScore');
            if (currentHandRank) currentHandRank.textContent = '-';
            if (currentHandScore) currentHandScore.textContent = '0';
            
            const exchangeBtn = document.getElementById('exchangeBtn');
            const finishRoundBtn = document.getElementById('finishRoundBtn');
            const nextRoundBtn = document.getElementById('nextRoundBtn');
            const newGameBtn = document.getElementById('newGameBtn');
            
            if (exchangeBtn) {
                exchangeBtn.style.display = 'inline-block';
                exchangeBtn.disabled = false;
            }
            if (finishRoundBtn) finishRoundBtn.style.display = 'inline-block';
            if (nextRoundBtn) nextRoundBtn.style.display = 'none';
            if (newGameBtn) newGameBtn.style.display = 'none';
            
            setTimeout(() => {
                const playerCards = document.querySelectorAll('#playerHand .card');
                const computerCards = document.querySelectorAll('#computerHand .card');
                
                [...playerCards, ...computerCards].forEach((card, index) => {
                    setTimeout(() => {
                        card.style.opacity = '1';
