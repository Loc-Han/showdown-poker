<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Showdown Poker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .screen {
            display: none;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }

        .screen.active {
            display: block;
        }

        h1 {
            font-size: 2em;
            margin-bottom: 20px;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        h2 {
            font-size: 1.3em;
            margin-bottom: 20px;
        }

        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            border-radius: 25px;
            padding: 15px 30px;
            font-size: 1.1em;
            color: white;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .nickname-input {
            padding: 15px 20px;
            font-size: 1.2em;
            border: none;
            border-radius: 25px;
            margin: 20px;
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            width: 300px;
            max-width: 90%;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .hand {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .card {
            width: 80px;
            height: 120px;
            background: white;
            border: 2px solid #333;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
            font-weight: bold;
            font-size: 14px;
        }

        .card.selected {
            border-color: #e74c3c;
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.6);
            background: #ffe6e6;
            transform: translateY(-10px);
        }

        .card.red {
            color: #e74c3c;
        }

        .card.black {
            color: #2c3e50;
        }

        .card.joker {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
        }

        .card-back {
            background: linear-gradient(45deg, #2c5aa0, #1e3c72);
            color: white;
        }

        .result {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .ranking {
            max-width: 500px;
            margin: 20px auto;
        }

        .ranking-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        @media (max-width: 600px) {
            .card {
                width: 60px;
                height: 90px;
                font-size: 12px;
            }
            
            .hand {
                gap: 5px;
            }
            
            .container {
                padding: 10px;
            }
            
            .game-info {
                font-size: 12px;
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 닉네임 입력 화면 -->
        <div class="screen active" id="nicknameScreen">
            <h1>Showdown Poker</h1>
            <h2>닉네임을 입력하고 게임을 시작하세요</h2>
            <input type="text" class="nickname-input" id="nicknameInput" placeholder="닉네임 입력" maxlength="10">
            <br>
            <button onclick="startGame()">게임 시작</button>
            <button onclick="showRanking()">랭킹 보기</button>
        </div>

        <!-- 랭킹 화면 -->
        <div class="screen" id="rankingScreen">
            <h1>랭킹</h1>
            <div class="ranking">
                <div id="rankingList">
                    <div class="ranking-item">
                        <span>아직 순위가 없습니다</span>
                        <span>첫 게임을 시작해보세요!</span>
                    </div>
                </div>
            </div>
            <button onclick="showNicknameInput()">돌아가기</button>
        </div>

        <!-- 게임 화면 -->
        <div class="screen" id="gameScreen">
            <div class="game-info">
                <div>플레이어: <span id="playerName"></span> | 점수: <span id="playerScore">0</span></div>
                <div>라운드: <span id="currentRound">1</span> / 5 | 교환: <span id="exchangesLeft">3</span></div>
                <div>컴퓨터 점수: <span id="computerScore">0</span></div>
            </div>

            <h3>컴퓨터 카드</h3>
            <div class="hand" id="computerHand"></div>
            <div class="result" id="computerResult"></div>
            
            <h3>내 카드 (클릭하여 교체 선택)</h3>
            <div class="hand" id="playerHand"></div>
            <div class="result" id="playerCurrentHand">
                <h4>현재 패: <span id="currentHandRank">-</span> | 예상 점수: <span id="currentHandScore">0</span>점</h4>
            </div>
            <div class="result" id="playerResult"></div>

            <div>
                <button id="exchangeBtn" onclick="exchangeCards()">카드 교환</button>
                <button id="finishRoundBtn" onclick="finishRound()">라운드 완료</button>
                <button id="nextRoundBtn" onclick="nextRound()" style="display: none;">다음 라운드</button>
                <button id="newGameBtn" onclick="showNewGameOptions()" style="display: none;">게임 완료</button>
                <button onclick="showNicknameInput()">새 게임</button>
            </div>
        </div>

        <!-- 게임 완료 화면 -->
        <div class="screen" id="gameCompleteScreen">
            <h1 id="gameResult"></h1>
            <div id="finalScores"></div>
            
            <div class="ranking">
                <h2>최종 랭킹</h2>
                <div id="finalRankingList"></div>
            </div>
            
            <button onclick="startNewGame()">새 게임</button>
        </div>
    </div>

    <script>
        // 게임 변수
        let currentPlayer = '';
        let currentRound = 1;
        let playerScore = 0;
        let computerScore = 0;
        let playerHand = [];
        let computerHand = [];
        let deck = [];
        let exchangesLeft = 3;
        let computerExchangesLeft = 3;
        let roundComplete = false;

        // 카드 클래스
        class Card {
            constructor(suit, rank, isJoker = false) {
                this.suit = suit;
                this.rank = rank;
                this.isJoker = isJoker;
                this.isSelected = false;
                this.value = isJoker ? 0 : (rank === 'A' ? 1 : (rank === 'J' ? 11 : (rank === 'Q' ? 12 : (rank === 'K' ? 13 : parseInt(rank)))));
            }

            toString() {
                if (this.isJoker) return 'JOKER';
                return this.rank + this.suit;
            }

            getColor() {
                if (this.isJoker) return 'joker';
                return (this.suit === 'H' || this.suit === 'D') ? 'red' : 'black';
            }
        }

        // 덱 생성
        function createDeck() {
            const suits = ['H', 'D', 'C', 'S'];
            const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
            deck = [];
            
            for (let suit of suits) {
                for (let rank of ranks) {
                    deck.push(new Card(suit, rank));
                }
            }
            deck.push(new Card('', 'JOKER', true));
        }

        // 덱 셔플
        function shuffleDeck() {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        // 카드 배분
        function dealCards() {
            playerHand = [];
            computerHand = [];
            for (let i = 0; i < 5; i++) {
                playerHand.push(deck.pop());
                computerHand.push(deck.pop());
            }
        }

        // 족보 판정 (단순화)
        function evaluateHand(hand) {
            const counts = {};
            let hasJoker = false;
            
            hand.forEach(card => {
                if (card.isJoker) {
                    hasJoker = true;
                } else {
                    counts[card.value] = (counts[card.value] || 0) + 1;
                }
            });

            const countValues = Object.values(counts).sort((a, b) => b - a);
            
            if (hasJoker) {
                if (countValues[0] === 2) {
                    return { rank: 4, name: '트리플', score: 400 };
                }
                return { rank: 2, name: '원페어', score: 200 };
            }

            if (countValues[0] === 4) {
                return { rank: 8, name: '포카드', score: 800 };
            }
            if (countValues[0] === 3 && countValues[1] === 2) {
                return { rank: 7, name: '풀하우스', score: 700 };
            }
            if (countValues[0] === 3) {
                return { rank: 4, name: '트리플', score: 400 };
            }
            if (countValues[0] === 2 && countValues[1] === 2) {
                return { rank: 3, name: '투페어', score: 300 };
            }
            if (countValues[0] === 2) {
                return { rank: 2, name: '원페어', score: 200 };
            }
            
            const values = Object.keys(counts).map(k => parseInt(k));
            return { rank: 1, name: '하이카드', score: Math.max(...values) * 10 };
        }

        // 화면 전환
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function showNicknameInput() {
            showScreen('nicknameScreen');
            document.getElementById('nicknameInput').value = '';
            document.getElementById('nicknameInput').focus();
        }

        function showRanking() {
            showScreen('rankingScreen');
            updateRankingDisplay();
        }

        function startGame() {
            const nickname = document.getElementById('nicknameInput').value.trim();
            if (!nickname) {
                alert('닉네임을 입력해주세요.');
                return;
            }
            
            currentPlayer = nickname;
            currentRound = 1;
            playerScore = 0;
            computerScore = 0;
            
            showScreen('gameScreen');
            startNewRound();
        }

        function startNewRound() {
            exchangesLeft = 3;
            computerExchangesLeft = 3;
            roundComplete = false;
            
            createDeck();
            shuffleDeck();
            dealCards();
            
            playerHand.forEach(card => card.isSelected = false);
            
            updateGameUI();
            updateHandDisplay();
            
            document.getElementById('exchangeBtn').style.display = 'inline-block';
            document.getElementById('finishRoundBtn').style.display = 'inline-block';
            document.getElementById('nextRoundBtn').style.display = 'none';
            document.getElementById('newGameBtn').style.display = 'none';
            document.getElementById('playerCurrentHand').style.display = 'block';
            document.getElementById('playerResult').innerHTML = '';
            document.getElementById('computerResult').innerHTML = '';
            
            updateCurrentHandDisplay();
        }

        function updateGameUI() {
            document.getElementById('playerName').textContent = currentPlayer;
            document.getElementById('currentRound').textContent = currentRound;
            document.getElementById('playerScore').textContent = playerScore;
            document.getElementById('computerScore').textContent = computerScore;
            document.getElementById('exchangesLeft').textContent = exchangesLeft;
        }

        function updateHandDisplay() {
            updatePlayerHand();
            updateComputerHand();
        }

        function updatePlayerHand() {
            const handElement = document.getElementById('playerHand');
            handElement.innerHTML = '';
            
            playerHand.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = `card ${card.getColor()}`;
                if (card.isSelected) cardElement.classList.add('selected');
                cardElement.textContent = card.toString();
                cardElement.onclick = () => toggleCardSelected(index);
                handElement.appendChild(cardElement);
            });
        }

        function updateComputerHand() {
            const handElement = document.getElementById('computerHand');
            handElement.innerHTML = '';
            
            computerHand.forEach(card => {
                const cardElement = document.createElement('div');
                if (roundComplete) {
                    cardElement.className = `card ${card.getColor()}`;
                    cardElement.textContent = card.toString();
                } else {
                    cardElement.className = 'card card-back';
                    cardElement.textContent = 'BACK';
                }
                handElement.appendChild(cardElement);
            });
        }

        function updateCurrentHandDisplay() {
            try {
                const result = evaluateHand(playerHand);
                document.getElementById('currentHandRank').textContent = result.name;
                document.getElementById('currentHandScore').textContent = result.score;
            } catch (e) {
                document.getElementById('currentHandRank').textContent = '-';
                document.getElementById('currentHandScore').textContent = '0';
            }
        }

        function toggleCardSelected(index) {
            if (roundComplete) return;
            playerHand[index].isSelected = !playerHand[index].isSelected;
            updatePlayerHand();
        }

        function exchangeCards() {
            if (exchangesLeft <= 0 || roundComplete) return;
            
            const selectedIndices = [];
            playerHand.forEach((card, index) => {
                if (card.isSelected) selectedIndices.push(index);
            });
            
            if (selectedIndices.length === 0) {
                alert('교체할 카드를 선택해주세요.');
                return;
            }
            
            selectedIndices.forEach(index => {
                playerHand[index] = deck.pop();
                playerHand[index].isSelected = false;
            });
            
            // 컴퓨터도 교환
            if (computerExchangesLeft > 0) {
                const exchangeCount = Math.floor(Math.random() * 3) + 1;
                const indices = [];
                while (indices.length < exchangeCount && indices.length < 5) {
                    const randomIndex = Math.floor(Math.random() * 5);
                    if (!indices.includes(randomIndex)) {
                        indices.push(randomIndex);
                        computerHand[randomIndex] = deck.pop();
                    }
                }
                computerExchangesLeft--;
            }
            
            exchangesLeft--;
            updateHandDisplay();
            updateGameUI();
            updateCurrentHandDisplay();
            
            if (exchangesLeft === 0) {
                finishRound();
            }
        }

        function finishRound() {
            if (roundComplete) return;
            
            // 컴퓨터 남은 교환
            while (computerExchangesLeft > 0) {
                const exchangeCount = Math.floor(Math.random() * 2) + 1;
                for (let i = 0; i < exchangeCount && i < 5; i++) {
                    const randomIndex = Math.floor(Math.random() * 5);
                    computerHand[randomIndex] = deck.pop();
                }
                computerExchangesLeft--;
            }
            
            roundComplete = true;
            
            const playerResult = evaluateHand(playerHand);
            const computerResult = evaluateHand(computerHand);
            
            playerScore += playerResult.score;
            computerScore += computerResult.score;
            
            document.getElementById('playerCurrentHand').style.display = 'none';
            document.getElementById('playerResult').innerHTML = 
                `<h3>${playerResult.name}</h3><p>+${playerResult.score}점</p>`;
            document.getElementById('computerResult').innerHTML = 
                `<h3>${computerResult.name}</h3><p>+${computerResult.score}점</p>`;
            
            updateHandDisplay();
            updateGameUI();
            
            document.getElementById('exchangeBtn').style.display = 'none';
            document.getElementById('finishRoundBtn').style.display = 'none';
            
            if (currentRound < 5) {
                document.getElementById('nextRoundBtn').style.display = 'inline-block';
            } else {
                document.getElementById('newGameBtn').style.display = 'inline-block';
            }
        }

        function nextRound() {
            currentRound++;
            startNewRound();
        }

        function showNewGameOptions() {
            saveScore(currentPlayer, playerScore);
            
            const resultText = playerScore > computerScore ? 
                '승리!' : (playerScore === computerScore ? '무승부!' : '패배...');
            
            document.getElementById('gameResult').textContent = resultText;
            document.getElementById('finalScores').innerHTML = 
                `<div style="margin: 20px 0;">
                    <div>${currentPlayer}: ${playerScore}점</div>
                    <div>컴퓨터: ${computerScore}점</div>
                </div>`;
            
            updateFinalRankingDisplay();
            showScreen('gameCompleteScreen');
        }

        function startNewGame() {
            showNicknameInput();
        }

        function saveScore(nickname, score) {
            try {
                let rankings = JSON.parse(localStorage.getItem('pokerRankings') || '[]');
                rankings.push({ nickname: nickname, score: score });
                rankings.sort((a, b) => b.score - a.score);
                rankings = rankings.slice(0, 10);
                localStorage.setItem('pokerRankings', JSON.stringify(rankings));
            } catch (e) {
                console.log('랭킹 저장 실패');
            }
        }

        function updateRankingDisplay() {
            try {
                const rankings = JSON.parse(localStorage.getItem('pokerRankings') || '[]');
                const rankingList = document.getElementById('rankingList');
                
                if (rankings.length === 0) {
                    rankingList.innerHTML = '<div class="ranking-item"><span>아직 순위가 없습니다</span><span>첫 게임을 시작해보세요!</span></div>';
                } else {
                    rankingList.innerHTML = rankings.map((entry, index) => 
                        `<div class="ranking-item">
                            <span>${index + 1}위. ${entry.nickname}</span>
                            <span>${entry.score}점</span>
                        </div>`
                    ).join('');
                }
            } catch (e) {
                document.getElementById('rankingList').innerHTML = '<div class="ranking-item"><span>랭킹을 불러올 수 없습니다</span></div>';
            }
        }

        function updateFinalRankingDisplay() {
            try {
                const rankings = JSON.parse(localStorage.getItem('pokerRankings') || '[]');
                const rankingList = document.getElementById('finalRankingList');
                
                if (rankings.length === 0) {
                    rankingList.innerHTML = '<div class="ranking-item"><span>첫 게임 완료!</span></div>';
                } else {
                    rankingList.innerHTML = rankings.map((entry, index) => 
                        `<div class="ranking-item">
                            <span>${index + 1}위. ${entry.nickname}</span>
                            <span>${entry.score}점</span>
                        </div>`
                    ).join('');
                }
            } catch (e) {
                document.getElementById('finalRankingList').innerHTML = '<div class="ranking-item"><span>랭킹 표시 오류</span></div>';
            }
        }

        // 키보드 이벤트
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const activeScreen = document.querySelector('.screen.active');
                if (activeScreen && activeScreen.id === 'nicknameScreen') {
                    startGame();
                }
            }
        });

        // 페이지 로드 시
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('nicknameInput').focus();
        });
    </script>
</body>
</html>
